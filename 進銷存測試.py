import pandas as pd
import os
from datetime import datetime

class OrderManager:
    """
    æŸæš‰è‚¡ä»½æœ‰é™å…¬å¸ å°åˆ·é›»è·¯æ¿ç”Ÿç”¢é€šçŸ¥å–® è¨‚å–®ç®¡ç†é¡åˆ¥
    æ ¹æ“šæä¾›çš„åœ–ç‰‡æ¬„ä½è¨­è¨ˆæ•¸æ“šçµæ§‹ã€‚
    """
    def __init__(self, excel_file='order_data.xlsx'):
        self.excel_file = excel_file
        self.data = []  # å„²å­˜è¨‚å–®è³‡æ–™çš„åˆ—è¡¨
        self.load_data()

    def load_data(self):
        """å¾ Excel æª”æ¡ˆè¼‰å…¥ç¾æœ‰è³‡æ–™ã€‚å¦‚æœæª”æ¡ˆä¸å­˜åœ¨ï¼Œå‰‡åˆå§‹åŒ–ä¸€å€‹ç©ºçš„ DataFrameã€‚"""
        if os.path.exists(self.excel_file):
            try:
                self.df = pd.read_excel(self.excel_file)
                self.data = self.df.to_dict('records')
                print(f"âœ… æˆåŠŸå¾ {self.excel_file} è¼‰å…¥ {len(self.data)} ç­†è¨‚å–®ã€‚")
            except Exception as e:
                print(f"âš ï¸ è¼‰å…¥ Excel æª”æ¡ˆæ™‚ç™¼ç”ŸéŒ¯èª¤: {e}ã€‚å°‡ä»¥ç©ºè³‡æ–™å•Ÿå‹•ã€‚")
                self.initialize_dataframe()
        else:
            self.initialize_dataframe()
            print("ğŸ†• æ‰¾ä¸åˆ°è¨‚å–®æª”æ¡ˆï¼Œå·²åˆå§‹åŒ–è¨‚å–®ç®¡ç†ç³»çµ±ã€‚")

    def initialize_dataframe(self):
        """åˆå§‹åŒ–ç©ºçš„ Pandas DataFrameï¼Œå®šç¾©æ‰€æœ‰æ¬„ä½ã€‚"""
        self.columns = [
            "è¨‚å–®åºè™Ÿ", "ç™¼å–®æ—¥", "è¨‚å–®ç·¨è™Ÿ", "å» å…§æ–™è™Ÿ", "å®¢æˆ¶åç¨±", 
            "è£½ä½œ", "æ¿æå» ç‰Œ", "ç™¼æ–™å°ºå¯¸", "é˜²ç„Š", "è¡¨é¢è™•ç†", 
            "æ¿é‚Šè™•ç†", "å–®ç‰‡å°ºå¯¸", "å‡ºè²¨å°ºå¯¸", "ç‰¹æ®Šè¦æ±‚", "å‚™è¨»", 
            "ç†±å°ä¿‚æ•¸", "éŠ…ç®”åšåº¦", "æ–‡å­—", "åŸºæ¿åšåº¦", "æ’ç‰ˆç‰‡æ•¸", 
            "å…±æ¨¡æ–™è™Ÿ", "åº•ç‰‡ç·¨è™Ÿ", "äº¤è²¨æ—¥æœŸ", "è¨‚å–®æ•¸é‡", "æœ€ä½éœ€æ±‚é‡", 
            "ç¢ºèª", "æ‰¿èªæ›¸", "åº•ç‰‡æ›´æ–°"
        ]
        self.df = pd.DataFrame(columns=self.columns)

    def add_order(self, order_details):
        """
        æ–°å¢ä¸€ç­†è¨‚å–®è³‡æ–™ã€‚
        :param order_details: åŒ…å«è¨‚å–®è©³ç´°è³‡è¨Šçš„å­—å…¸ã€‚
        """
        # ç¢ºä¿å­—å…¸ä¸­çš„éµèˆ‡æ¬„ä½åç¨±ä¸€è‡´
        new_order = {col: order_details.get(col, '') for col in self.columns}
        
        self.data.append(new_order)
        self.df = pd.DataFrame(self.data)
        print(f"\nâœ¨ è¨‚å–® {new_order.get('è¨‚å–®åºè™Ÿ', 'N/A')} æ–°å¢æˆåŠŸï¼")

    def display_orders(self):
        """é¡¯ç¤ºç›®å‰æ‰€æœ‰è¨‚å–®çš„æ‘˜è¦è³‡è¨Šã€‚"""
        if self.df.empty:
            print("\nğŸš¨ ç›®å‰ç³»çµ±ä¸­æ²’æœ‰ä»»ä½•è¨‚å–®è³‡æ–™ã€‚")
            return
        
        # é¸æ“‡ä¸»è¦æ¬„ä½é€²è¡Œé¡¯ç¤º
        display_cols = ["è¨‚å–®åºè™Ÿ", "å®¢æˆ¶åç¨±", "è¨‚å–®æ•¸é‡", "ç™¼å–®æ—¥", "äº¤è²¨æ—¥æœŸ"]
        print("\n--- æ‰€æœ‰è¨‚å–®æ‘˜è¦ ---")
        print(self.df[display_cols].to_string(index=False))
        print("--------------------")

    def save_data(self):
        """å°‡ç›®å‰çš„æ‰€æœ‰è¨‚å–®è³‡æ–™å­˜å…¥ Excel æª”æ¡ˆã€‚"""
        try:
            self.df.to_excel(self.excel_file, index=False, engine='openpyxl')
            print(f"\nğŸ’¾ æ‰€æœ‰è¨‚å–®è³‡æ–™å·²æˆåŠŸå„²å­˜åˆ°æª”æ¡ˆï¼š{self.excel_file}")
        except Exception as e:
            print(f"\nâŒ å„²å­˜è³‡æ–™åˆ° Excel æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")

# --- ç¤ºç¯„ä½¿ç”¨ ---

# 1. åˆå§‹åŒ–è¨‚å–®ç®¡ç†å™¨
manager = OrderManager()

# 2. æº–å‚™ç¯„ä¾‹è¨‚å–®æ•¸æ“š (æ ¹æ“šæ‚¨çš„åœ–ç‰‡å¡«å¯«)
# æ³¨æ„ï¼šæ—¥æœŸæ ¼å¼å»ºè­°ä½¿ç”¨ YYYY/MM/DD
sample_order_1 = {
    "è¨‚å–®åºè™Ÿ": 12.207,
    "ç™¼å–®æ—¥": "2025/10/15",
    "è¨‚å–®ç·¨è™Ÿ": "1331-20251014002",
    "å» å…§æ–™è™Ÿ": "KT-277-0007B",
    "å®¢æˆ¶åç¨±": "PCFTZP2-01.0 / FZT å‰ç‡ˆ LEDç‡ˆæ¿ V2.0",
    "è£½ä½œ": "é‡ç”¢",
    "æ¿æå» ç‰Œ": "é¨°è¼VT-4B5(ç„¡é™½æ¥µ)(50um)",
    "ç™¼æ–™å°ºå¯¸": "510x610mm",
    "é˜²ç„Š": "äº®é¢é»‘ R500",
    "è¡¨é¢è™•ç†": "OSP",
    "æ¿é‚Šè™•ç†": "æ²– NC V-cut",
    "å–®ç‰‡å°ºå¯¸": "30.2 x 22.85mm",
    "å‡ºè²¨å°ºå¯¸": "154.8 x 136.26mm",
    "ç‰¹æ®Šè¦æ±‚": "â˜…ç‰¹æ®Šè¦æ±‚â†ç¦å®‰â˜…\n1. æ¨£å“è£½ä½œï¼Œæ‹†ç‡™åŠ æ‰‹æ”¹é€±æœŸ\n...\n4. 20200814 é–‹æ¨¡å…·(æ¨¡å…·è²»ç”¨128,000å…ƒï¼Œå®¢æˆ¶è² æ“”)\n5. 20210712 çºŒå–®ï¼Œé–‹å•Ÿå…·æ¸¬è©¦",
    "å‚™è¨»": "æŠ˜ç‡™äºæ”¹é€±æœŸ 2550(å…©æ‰¹ä¸€èµ·ç”Ÿç”¢ï¼Œæ­¤ç‚ºç¬¬äºŒæ‰¹)\né–‹å•Ÿæ²»å…·æ¸¬è©¦ä¸éœ€AOI\nç¦å®‰çš†éœ€ç‰¹æ®Šå…§æ¨™ç±¤",
    "ç†±å°ä¿‚æ•¸": "5W",
    "éŠ…ç®”åšåº¦": "1 oz",
    "æ–‡å­—": "ç™½è‰²",
    "åŸºæ¿åšåº¦": "1.6mm",
    "æ’ç‰ˆç‰‡æ•¸": "3 x 4 x 20 = 240",
    "å…±æ¨¡æ–™è™Ÿ": "KT-277-0007B",
    "åº•ç‰‡ç·¨è™Ÿ": "ULå°åˆ·ï¼šæ–‡å­—å±¤",
    "äº¤è²¨æ—¥æœŸ": "2026/1/5",
    "è¨‚å–®æ•¸é‡": 7500,
    "æœ€ä½éœ€æ±‚é‡": "SHT",
    "ç¢ºèª": "å®Œæˆ",
    "æ‰¿èªæ›¸": "å®Œæˆ",
    "åº•ç‰‡æ›´æ–°": "é€±æœŸæ›´æ–°"
}

# 3. æ–°å¢è¨‚å–®
manager.add_order(sample_order_1)

# 4. é¡¯ç¤ºæ‰€æœ‰è¨‚å–®
manager.display_orders()

# 5. å„²å­˜æ•¸æ“š
manager.save_data()